<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parking Locations in the Bronx</title>
  <script src="./data.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC-Yvj8rdYoGBMNcJWB4pLeGQss0aWKq2A"></script>
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>
<div style="width: 100%;">
  <input type="text" id="address" name="address" required placeholder="Type address here...">
  <button id="signUpButton">Submit</button>
  <div id="map"></div>

  <script>

    const signUpButton = document.querySelector("#signUpButton");
    var arr = data;
    function initMap() {
      const address = document.getElementById('address').value;
      const apiKey = 'AIzaSyDaFXlaMKGJPNDUme7clG5_7JRqthjsZe8';
      var Center = { lat: 40.837048, lng: -73.865433 }; // Example coordinates
      try {
        const response = fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(address)}&key=${apiKey}`);
        const data = response.json();

        if (data.status === "OK" && data.results.length > 0) {
          //Get lat and long from google api, and use that to compute the nearest garage

          Center = data.results[0].geometry.location;

          coordinatesData = `Address: ${address}\nLatitude: ${lat}\nLongitude: ${lng}`;
        }
      } catch (error) {

      }
      // Define the initial center location (e.g., a central spot in the Bronx)


      // Initialize the map centered on the Bronx
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 13,
        center: Center
      });

      // Array of parking lot locations with their info
      arr.sort(function(a,b){return calculateDistance(Center.lat, Center.lng, a.Latitude, a.Longitude) - calculateDistance(Center.lat, Center.lng, b.Latitude, b.Longitude)});

      // Loop through the parking locations to create markers with info windows
      for(var i = 0; i<5; i++) {
        const marker = new google.maps.Marker({
          position: { lat: arr[i]["Latitude"], lng: arr[i]["Longitude"] },
          map: map
        });

        // Info window for each marker
        const infoWindow = new google.maps.InfoWindow({
          content: arr[i]["Business Name"] +" | "+ arr[i]["Details"]
        });

        // Show info window on marker click
        marker.addListener("click", () => {
          infoWindow.open(map, marker);
        });
      }
    }

    function calculateDistance(lat1, lon1, lat2, lon2) {
      var R = 3958.8; // Radius of the Earth in miles
      var dLat = (lat2 - lat1) * Math.PI / 180;
      var dLon = (lon2 - lon1) * Math.PI / 180;

      var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
              Math.sin(dLon / 2) * Math.sin(dLon / 2);

      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

      var distance = R * c; // Distance in miles
      return distance;
    }

    // Load the map after the page loads

    signUpButton.addEventListener('click', initMap);
  </script>
</body>
</html>
